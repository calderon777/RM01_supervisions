---
title: "In-Class Exercise Sup 4"
draft: true
format: html
execute:
  echo: true
  warning: false
  message: false
---

## Learning goals (40 min)
- Fit a clear production model with meaningful regressors.
- Diagnose **multicollinearity** (VIF), **autocorrelation** (DW/BG & residual ACF), and **heteroskedasticity** (BP/White) and modify/refine the baseline model.
- Apply **robust/HAC** standard errors for valid inference.
- Communicate findings succinctly.

### Marking (formative)
- Task 1 (multicollinearity) â€“ 25 pts  
- Task 2 (autocorrelation) â€“ 25 pts  
- Task 3 (heteroskedasticity & robust SE) â€“ 25 pts  
- Task 4 (report results: final model spec, economic analysis & evaluation) â€“ 25 pts  
**Total: 100 pts**

---

## Setup

**Data**: The `rice` dataset contains a time series on rice production from Asian farms (1990-1997). Variables include:
  - `prod`: output (tons)
  - `area`: land (hectares)
  - `fert`: fertilizer (kg)
  - `labor`: labor hours (person-days)

```{r}
# Packages (minimal)
# install the following packages if needed.

library(PoEdata); library(dplyr); library(car); library(lmtest); library(sandwich)
```

1) Load `rice`, order by `year`.  
2) **Drop** the firm identifier (`firm`).  
3) Preview the data.

```{r}
# Load the dataset 'rice' from the PoEdata package (must have library(PoEdata) loaded)
data(rice)

# Sort the rows by the time variable so observations are in chronological order
rice <- rice[order(rice$year), ]

# Drop the identifier column 'firm' (it's just an ID, not an economic variable)
rice <- subset(rice, select = -firm)

# Look at the first 6 rows to get a quick sense of the data
head(rice, 6)

# List all column names so you know what variables are available
names(rice)
```

::: {.callout-tip collapse="true"}
**Why drop `firm`?** Itâ€™s an identifier, not an economic input. Keep IDs only for estimations involving grouping/panels, not as regressors.
:::

---

## Task 1 â€” Multicollinearity (25 pts)

Fit the **baseline model** that you will need to **modify/refine** if needed:
\[
\texttt{prod ~ area + fert + labor}
\]

```{r}
m <- lm(prod ~ area + fert + labor, data = rice)
summary(m)
```

Compute **VIF** and interpret.
```{r}
vif(m)
```

**Answer (brief, 150 words max):**  
1. State the VIF values and threshold used
2. Identify which variables show problematic collinearity
3. Suggest ONE specific econometric solution appropriate for this production function

---

## Task 2 â€” Autocorrelation (25 pts)

Run **Durbinâ€“Watson** and **Breuschâ€“Godfrey (AR1)** tests.  
Then **plot the residual ACF** to visualise the pattern. For example, the current model specification:

```{r}
# Durbinâ€“Watson test for first-order autocorrelation in OLS residuals
# H0: no autocorrelation (rho = 0). DW ~ 2 means no autocorr; DW < 2 = positive autocorr.
dwtest(m)

# Breuschâ€“Godfrey test for serial correlation of order 1 (more general than DW)
# H0: no serial correlation up to the specified order.
bgtest(m, order = 1)

# Extract OLS residuals from model m
res_m <- residuals(m)

# Plot the autocorrelation function of residuals
# Significant spike at lag 1 (outside blue bands) suggests AR(1)-type positive autocorrelation
acf(res_m, main = "ACF of OLS residuals (m)")
```

**Answer (brief, 150 words max):**  
- Do tests indicate autocorrelation? Which sign? did you modify/refine the model? 
- What does the residual **ACF** suggest (e.g., AR(1)-type)? How would you address the issue for inference?

::: {.callout-tip collapse="true"}
**Hint:** DW < 2 â†’ positive serial correlation. A large spike at lag 1 in ACF is consistent with AR(1).
:::

---

## Task 3 â€” Heteroskedasticity & Robust/HAC SE (25 pts)

1) Test for heteroskedasticity: **Breuschâ€“Pagan** and a **White-style** auxiliary test.  
2) Report **HAC (Neweyâ€“West)** standard errors for valid inference under both heteroskedasticity and autocorrelation.

```{r}
# --- Heteroskedasticity tests -----------------------------------------------

# Breuschâ€“Pagan test for heteroskedasticity
# H0: constant variance (homoskedasticity). Small p-value => heteroskedasticity present.
bptest(m)

# "White-style" test: regress squared residuals on fitted and fitted^2 (more general form)
fit <- fitted(m)
bptest(m, ~ fit + I(fit^2))  # small p-value => heteroskedasticity

# --- Robust inference when heteroskedasticity and/or autocorrelation exist ---

# Neweyâ€“West (HAC) robust standard errors for valid t-stats/p-values
# Note: This adjusts SEs, not coefficients; residual patterns/tests remain the same.
coeftest(m, vcov. = NeweyWest(m, lag = 1, prewhite = FALSE))
#**White test specification**: The `~ fit + I(fit^2)` is one 
# version; this is a simplified White test.

```

**Answer (brief, 150 words max):**  
- Are BP/White significant? Compare classical vs HAC p-values: which coefficients remain significant?

::: {.callout-tip collapse="true"}
**Note:** Robust/HAC SEs **do not change** the residuals or DW/BG results; they change inference (SEs/p-values).
:::

---

## Task 4 â€” report results: final model spec, economic analysis & evaluation (25 pts)

**Summarise (250 words max) (25 pts):** 
1. Your best/final model specification (equation)
2. The key diagnostic issues you found (which tests, what they showed)
3. The remedies you applied (e.g. variable interactions, lags, HAC)
4. Why your final inference is valid for decision-making, results analysis and evaluation (brief economic interpretation).

---

## **Submit your answers**

Please submit your completed answers using the embedded form below 
ðŸ‘‡  If the form does not display correctly, you can open it directly using this link:  
ðŸ‘‰ [Open Microsoft Form](https://forms.office.com/Pages/ResponsePage.aspx?id=RQSlSfq9eUut41R7TzmG6e2v58mrCWNIjQV8bfnU-6tUOThTQVBYTlBZSEpJWUxFNUpBNEw3MlA3Ui4u)

<div style="margin-top: 1em; margin-bottom: 1em;">
<iframe width="640px" height="480px"
  src="https://forms.office.com/Pages/ResponsePage.aspx?id=RQSlSfq9eUut41R7TzmG6e2v58mrCWNIjQV8bfnU-6tUOThTQVBYTlBZSEpJWUxFNUpBNEw3MlA3Ui4u&embed=true"
  frameborder="0"
  marginwidth="0"
  marginheight="0"
  style="border: none; max-width:100%; max-height:100vh;"
  allowfullscreen
  webkitallowfullscreen
  mozallowfullscreen
  msallowfullscreen>
</iframe>
</div>

---




