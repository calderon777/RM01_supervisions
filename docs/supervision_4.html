<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Supervision 4 – Research Methods for Land Economy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./supervision_5.html" rel="next">
<link href="./supervision_3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-13f3b9144cfbd4bffe19d1212ca92176.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="icons.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./supervision_4.html"><span class="chapter-title">Supervision 4</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Research Methods for Land Economy</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Welcome and Supervision Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./supervision_1.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Supervision 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./supervision_2.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Supervision 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./supervision_3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Supervision 3</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./supervision_4.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Supervision 4</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./supervision_5.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Supervision 5</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./formative_test_sup3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">In-Class Exercise Sup 3</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./solution_formative_test_sup3.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Solution to In-class Sup3</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#lab-14-collinearity" id="toc-lab-14-collinearity" class="nav-link active" data-scroll-target="#lab-14-collinearity">Lab 14 — Collinearity</a>
  <ul class="collapse">
  <li><a href="#learning-outcomes" id="toc-learning-outcomes" class="nav-link" data-scroll-target="#learning-outcomes">🎯 Learning outcomes</a></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">🧰 Prerequisites</a></li>
  <li><a href="#overview-why-collinearity-matters" id="toc-overview-why-collinearity-matters" class="nav-link" data-scroll-target="#overview-why-collinearity-matters">Overview: why collinearity matters</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">🧰 Packages</a></li>
  <li><a href="#variance-inflation-factor-vif" id="toc-variance-inflation-factor-vif" class="nav-link" data-scroll-target="#variance-inflation-factor-vif">Variance Inflation Factor (VIF)</a></li>
  <li><a href="#mitigations-when-vifs-are-high" id="toc-mitigations-when-vifs-are-high" class="nav-link" data-scroll-target="#mitigations-when-vifs-are-high">Mitigations (when VIFs are high)</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  <li><a href="#lab-15-heteroskedasticity" id="toc-lab-15-heteroskedasticity" class="nav-link" data-scroll-target="#lab-15-heteroskedasticity">Lab 15 — Heteroskedasticity</a>
  <ul class="collapse">
  <li><a href="#learning-outcomes-1" id="toc-learning-outcomes-1" class="nav-link" data-scroll-target="#learning-outcomes-1">🎯 Learning outcomes</a></li>
  <li><a href="#prerequisites-1" id="toc-prerequisites-1" class="nav-link" data-scroll-target="#prerequisites-1">🧰 Prerequisites</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#packages-1" id="toc-packages-1" class="nav-link" data-scroll-target="#packages-1">🧰 Packages</a></li>
  <li><a href="#spotting-heteroskedasticity-with-residual-plots" id="toc-spotting-heteroskedasticity-with-residual-plots" class="nav-link" data-scroll-target="#spotting-heteroskedasticity-with-residual-plots">Spotting heteroskedasticity with residual plots</a></li>
  <li><a href="#breuschpagan-test-manual-construction" id="toc-breuschpagan-test-manual-construction" class="nav-link" data-scroll-target="#breuschpagan-test-manual-construction">Breusch–Pagan test (manual construction)</a></li>
  <li><a href="#white-quadratic-version" id="toc-white-quadratic-version" class="nav-link" data-scroll-target="#white-quadratic-version">White (quadratic) version</a></li>
  <li><a href="#breuschpagan-with-bptest" id="toc-breuschpagan-with-bptest" class="nav-link" data-scroll-target="#breuschpagan-with-bptest">Breusch–Pagan with <code>bptest()</code></a></li>
  <li><a href="#goldfeldquandt-test-indicator-split-metro-vs-rural" id="toc-goldfeldquandt-test-indicator-split-metro-vs-rural" class="nav-link" data-scroll-target="#goldfeldquandt-test-indicator-split-metro-vs-rural">Goldfeld–Quandt test (indicator split: metro vs rural)</a></li>
  <li><a href="#heteroskedasticityconsistent-hc-standard-errors" id="toc-heteroskedasticityconsistent-hc-standard-errors" class="nav-link" data-scroll-target="#heteroskedasticityconsistent-hc-standard-errors">Heteroskedasticity‑consistent (HC) standard errors</a></li>
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1">Summary</a></li>
  </ul></li>
  <li><a href="#lab-16-serial-correlation-autocorrelation" id="toc-lab-16-serial-correlation-autocorrelation" class="nav-link" data-scroll-target="#lab-16-serial-correlation-autocorrelation">Lab 16 — Serial Correlation (Autocorrelation)</a>
  <ul class="collapse">
  <li><a href="#learning-outcomes-2" id="toc-learning-outcomes-2" class="nav-link" data-scroll-target="#learning-outcomes-2">🎯 Learning outcomes</a></li>
  <li><a href="#prerequisites-2" id="toc-prerequisites-2" class="nav-link" data-scroll-target="#prerequisites-2">🧰 Prerequisites</a></li>
  <li><a href="#overview-1" id="toc-overview-1" class="nav-link" data-scroll-target="#overview-1">Overview</a></li>
  <li><a href="#example-growth-vs-unemployment-okuns-data" id="toc-example-growth-vs-unemployment-okuns-data" class="nav-link" data-scroll-target="#example-growth-vs-unemployment-okuns-data">Example: growth vs unemployment (Okun’s data)</a></li>
  <li><a href="#phillips-curve-example-and-bgdw-tests" id="toc-phillips-curve-example-and-bgdw-tests" class="nav-link" data-scroll-target="#phillips-curve-example-and-bgdw-tests">Phillips curve example and BG/DW tests</a></li>
  <li><a href="#summary-2" id="toc-summary-2" class="nav-link" data-scroll-target="#summary-2">Summary</a></li>
  </ul></li>
  <li><a href="#lab-17-hac-neweywest-standard-errors" id="toc-lab-17-hac-neweywest-standard-errors" class="nav-link" data-scroll-target="#lab-17-hac-neweywest-standard-errors">Lab 17 — HAC (Newey–West) Standard Errors</a>
  <ul class="collapse">
  <li><a href="#learning-outcomes-3" id="toc-learning-outcomes-3" class="nav-link" data-scroll-target="#learning-outcomes-3">🎯 Learning outcomes</a></li>
  <li><a href="#prerequisites-3" id="toc-prerequisites-3" class="nav-link" data-scroll-target="#prerequisites-3">🧰 Prerequisites</a></li>
  <li><a href="#overview-2" id="toc-overview-2" class="nav-link" data-scroll-target="#overview-2">Overview</a></li>
  <li><a href="#summary-3" id="toc-summary-3" class="nav-link" data-scroll-target="#summary-3">Summary</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Supervision 4</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="lab-14-collinearity" class="level2">
<h2 class="anchored" data-anchor-id="lab-14-collinearity">Lab 14 — Collinearity</h2>
<section id="learning-outcomes" class="level3">
<h3 class="anchored" data-anchor-id="learning-outcomes">🎯 Learning outcomes</h3>
<ul>
<li>Understand what <strong>collinearity (multicollinearity)</strong> is and why it matters for regression inference.</li>
<li>Recognise how collinearity inflates <strong>standard errors</strong>, weakening <strong>t‑tests</strong> for individual coefficients.</li>
<li>Diagnose collinearity using the <strong>Variance Inflation Factor (VIF)</strong> and interpret typical thresholds.</li>
<li>Implement VIF diagnostics in R with <code>car::vif()</code> and report results clearly (tables, captions).</li>
<li>Consider practical remedies (drop variables, transform/aggregate predictors, or rethink specification).</li>
</ul>
<hr>
</section>
<section id="prerequisites" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites">🧰 Prerequisites</h3>
<ul>
<li>Multiple regression basics (OLS, <span class="math inline">\(R^2\)</span>, F‑test, t‑tests).</li>
<li>R and RStudio installed.</li>
<li>Packages: <code>PoEdata</code>, <code>broom</code>, <code>knitr</code>, <code>car</code>.</li>
</ul>
<hr>
</section>
<section id="overview-why-collinearity-matters" class="level3">
<h3 class="anchored" data-anchor-id="overview-why-collinearity-matters">Overview: why collinearity matters</h3>
<p>Collinearity does <strong>not bias</strong> OLS, but it <strong>inflates the variance</strong> of estimated coefficients. As a result, t‑tests lose power and coefficient signs may look unstable across specifications—even when the model has a high <span class="math inline">\(R^2\)</span>. Diagnostics such as <strong>VIF</strong> help decide whether variables overlap so much that individual effects are hard to interpret.</p>
<hr>
<p>Collinearity (multicollinearity) among regressors occurs when two or more move closely together or have limited variability. It <strong>inflates the variance</strong> of estimated parameters (less precise t-tests), even though OLS estimates remain unbiased. As a result, a model may have a high <span class="math inline">\(R^2\)</span> or a large F‑statistic but <strong>insignificant individual coefficients</strong>.</p>
</section>
<section id="packages" class="level3">
<h3 class="anchored" data-anchor-id="packages">🧰 Packages</h3>
<p><code>PoEdata</code>, <code>broom</code>, <code>knitr</code>, <code>car</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("PoEdata","broom","knitr","car")) ; install once if not already installed</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PoEdata)  <span class="co"># example datasets used in the course</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)    <span class="co"># tidier model outputs (tidy/glance/augment)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'broom' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)    <span class="co"># neat tables/printing (e.g., kable)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'knitr' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)      <span class="co"># regression diagnostics (e.g., VIF)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example data: cars (mpg = miles per gallon; cyl = cylinders; disp = engine displacement; wt = weight)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple model</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a linear regression: mpg explained by cylinders</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> cyl, <span class="at">data =</span> mtcars)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># convert model output to a neat table (broom::tidy + knitr::kable)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">tidy</span>(mod1), <span class="at">caption =</span> <span class="st">"A simple linear 'mpg' model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>A simple linear ‘mpg’ model</caption>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">37.88458</td>
<td style="text-align: right;">2.0738436</td>
<td style="text-align: right;">18.267808</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">cyl</td>
<td style="text-align: right;">-2.87579</td>
<td style="text-align: right;">0.3224089</td>
<td style="text-align: right;">-8.919699</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now add more regressors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a multiple regression with 3 predictors (cyl, disp, wt)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> cyl <span class="sc">+</span> disp <span class="sc">+</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># format the model output into a clean table</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">tidy</span>(mod2), <span class="at">caption =</span> <span class="st">"Multivariate 'mpg' model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Multivariate ‘mpg’ model</caption>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">41.1076776</td>
<td style="text-align: right;">2.8424260</td>
<td style="text-align: right;">14.4621802</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">cyl</td>
<td style="text-align: right;">-1.7849435</td>
<td style="text-align: right;">0.6071105</td>
<td style="text-align: right;">-2.9400638</td>
<td style="text-align: right;">0.0065117</td>
</tr>
<tr class="odd">
<td style="text-align: left;">disp</td>
<td style="text-align: right;">0.0074729</td>
<td style="text-align: right;">0.0118447</td>
<td style="text-align: right;">0.6309079</td>
<td style="text-align: right;">0.5332173</td>
</tr>
<tr class="even">
<td style="text-align: left;">wt</td>
<td style="text-align: right;">-3.6356770</td>
<td style="text-align: right;">1.0401375</td>
<td style="text-align: right;">-3.4953811</td>
<td style="text-align: right;">0.0015955</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>When adding <strong>eng</strong> and <strong>wgt</strong>, the coefficient for <strong>cyl</strong> can turn <strong>insignificant</strong>—a classic sign of collinearity because these vehicle traits tend to move together.</p>
</div>
</div>
</section>
<section id="variance-inflation-factor-vif" class="level3">
<h3 class="anchored" data-anchor-id="variance-inflation-factor-vif">Variance Inflation Factor (VIF)</h3>
<p>The VIF for regressor <span class="math inline">\(x_k\)</span> is <span class="math inline">\(VIF_k = \dfrac{1}{1-R_k^2}\)</span>, where <span class="math inline">\(R_k^2\)</span> is from regressing <span class="math inline">\(x_k\)</span> on the other regressors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">vif</span>(mod2)                           <span class="co"># calculate VIF values to diagnose multicollinearity</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">regressor =</span> <span class="fu">names</span>(v),       <span class="co"># create a small table with regressor names</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">VIF =</span> <span class="fu">as.numeric</span>(v),        <span class="co"># convert VIF values to numeric for display</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">row.names =</span> <span class="cn">NULL</span>)           <span class="co"># avoid row names in the table</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tab, <span class="at">caption =</span> <span class="st">"Variance inflation factors for the 'mpg' regression model."</span>)  <span class="co"># nicely format output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Variance inflation factors for the ‘mpg’ regression model.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">regressor</th>
<th style="text-align: right;">VIF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">cyl</td>
<td style="text-align: right;">5.413600</td>
</tr>
<tr class="even">
<td style="text-align: left;">disp</td>
<td style="text-align: right;">9.924054</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wt</td>
<td style="text-align: right;">4.769703</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Rules of thumb</strong><br>
- <strong>VIF &gt; 10</strong> → strong collinearity (commonly used cutoff)<br>
- <strong>VIF &gt; 5</strong> → moderate collinearity (early warning) These cut-offs are only heuristics. Evaluate VIFs alongside theory, sample size, and model purpose; high VIFs don’t automatically require dropping variables (O’Brien, 2007).</p>
</div>
</div>
</section>
<section id="mitigations-when-vifs-are-high" class="level3">
<h3 class="anchored" data-anchor-id="mitigations-when-vifs-are-high">Mitigations (when VIFs are high)</h3>
<ul>
<li>Remove or combine collinear variables (e.g., combine <strong>cyl</strong> and <strong>eng</strong> into a power index).<br>
</li>
<li>Use <strong>PCA</strong> to produce orthogonal components.<br>
</li>
<li><strong>Standardise/centre</strong> variables (helps especially with interactions/polynomials (it won’t “fix” genuine overlap among distinct variables).<br>
</li>
<li>Use <strong>Ridge regression</strong> if retaining all variables is preferred.<br>
</li>
<li>Consider <strong>transformations</strong> (e.g., logs).</li>
</ul>
<hr>
</section>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<ul>
<li>Collinearity leaves OLS <strong>unbiased</strong> but makes estimates <strong>imprecise</strong>.</li>
<li>Always check <strong>VIFs</strong> when several predictors are conceptually related.</li>
<li>If VIFs are high, consider <strong>dropping</strong>, <strong>combining</strong>, or <strong>re‑specifying</strong> predictors—and justify choices with theory.</li>
</ul>
<p><strong>References</strong> O’Brien, Robert. (2007). A Caution Regarding Rules of Thumb for Variance Inflation Factors. Quality &amp; Quantity. 41. 673-690. 10.1007/s11135-006-9018-6.</p>
<hr>
</section>
</section>
<section id="lab-15-heteroskedasticity" class="level2">
<h2 class="anchored" data-anchor-id="lab-15-heteroskedasticity">Lab 15 — Heteroskedasticity</h2>
<section id="learning-outcomes-1" class="level3">
<h3 class="anchored" data-anchor-id="learning-outcomes-1">🎯 Learning outcomes</h3>
<ul>
<li>Understand the key concept(s) introduced in this lab and their purpose in empirical analysis.</li>
<li>Correctly implement the core R workflow for this topic and present clean, well-captioned results.</li>
<li>Interpret model output in context and link diagnostics to modeling choices.</li>
<li>Recognise common pitfalls and apply simple robustness checks.</li>
</ul>
<hr>
</section>
<section id="prerequisites-1" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites-1">🧰 Prerequisites</h3>
<ul>
<li>Prior exposure to multiple regression and basic inference (t-tests, F-tests).</li>
<li>R and RStudio installed.</li>
<li>Packages: <code>PoEdata</code>, <code>broom</code>, <code>knitr</code>, plus any additional packages used in this lab.</li>
</ul>
<hr>
</section>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">Overview</h3>
<p>This lab introduces the core idea, why it matters for inference and decision-making, and where it fits in the broader modeling workflow. You will practise the implementation in R, interpret outputs carefully, and connect diagnostics back to modeling decisions.</p>
<hr>
<p>The Gauss–Markov theorem assumes <strong>homoskedasticity</strong> (constant error variance <span class="math inline">\(\sigma^2\)</span>). In many economic datasets, variance grows with some regressors (e.g., higher‑income households show more dispersion in expenditure). With heteroskedasticity, OLS coefficients remain unbiased, but <strong>standard errors</strong> and therefore, with heteroskedasticity, OLS coefficients remain unbiased (under exogeneity) but the usual SEs are inconsistent—use HC (White) or other robust SEs. For completeness, apart from homoskedasticity, Gauss–Markov (for OLS to be BLUE) also requires linearity in parameters, no perfect collinearity, and exogeneity. Independence/no autocorrelation is also standard in time-series contexts.</p>
</section>
<section id="packages-1" class="level3">
<h3 class="anchored" data-anchor-id="packages-1">🧰 Packages</h3>
<p><code>lmtest</code>, <code>broom</code>, <code>PoEdata</code>, <code>car</code>, <code>sandwich</code>, <code>knitr</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("lmtest","broom","PoEdata","car","sandwich","knitr"))  # install once if needed</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)    <span class="co"># tests for regression models (e.g., Breusch-Pagan)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'zoo' was built under R version 4.4.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)     <span class="co"># tidy/glance/augment model outputs</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PoEdata)   <span class="co"># course datasets</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)       <span class="co"># diagnostics (e.g., VIF)</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)  <span class="co"># robust (heteroskedasticity-consistent) SEs</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)     <span class="co"># neat tables (kable)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"food"</span>, <span class="at">package =</span> <span class="st">"PoEdata"</span>)            <span class="co"># load the 'food' dataset</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(food_exp <span class="sc">~</span> income, <span class="at">data =</span> food)   <span class="co"># simple OLS: food expenditure explained by income</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter and fitted line</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(food<span class="sc">$</span>income, food<span class="sc">$</span>food_exp,             <span class="co"># scatterplot of income vs. food expenditure</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"income"</span>, <span class="at">ylab =</span> <span class="st">"food expenditure"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"grey"</span>)                 <span class="co"># filled points, grey color</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod1, <span class="at">lwd =</span> <span class="dv">2</span>)                        <span class="co"># add fitted regression line with thicker stroke</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="supervision_4_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="spotting-heteroskedasticity-with-residual-plots" class="level3">
<h3 class="anchored" data-anchor-id="spotting-heteroskedasticity-with-residual-plots">Spotting heteroskedasticity with residual plots</h3>
<p>Residual plots help detect heteroskedasticity visually. Under homoskedasticity, residuals should scatter randomly around zero with constant spread. Look for:</p>
<ul>
<li>Fanning patterns: residuals spread out (or narrow) as x increases</li>
<li>Clusters or groups: different variance across subpopulations</li>
<li>Non-random patterns: suggests model misspecification</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>res  <span class="ot">&lt;-</span> <span class="fu">residuals</span>(mod1)          <span class="co"># residuals (observed - fitted)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod1)             <span class="co"># fitted (predicted) values from the model</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuals vs. income (check for nonlinearity or changing spread with income)</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(food<span class="sc">$</span>income, res,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"income"</span>, <span class="at">ylab =</span> <span class="st">"residuals"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)           <span class="co"># reference line at zero residual</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="supervision_4_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuals vs. fitted values (diagnose heteroskedasticity/patterns)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yhat, res,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"fitted values"</span>, <span class="at">ylab =</span> <span class="st">"residuals"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">"grey"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)           <span class="co"># reference line at zero residual</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="supervision_4_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="breuschpagan-test-manual-construction" class="level3">
<h3 class="anchored" data-anchor-id="breuschpagan-test-manual-construction">Breusch–Pagan test (manual construction)</h3>
<p>The Breusch–Pagan test is a formal test for heteroskedasticity. The null hypothesis is <span class="math inline">\(H_0:\)</span> <span class="math inline">\(\text{homoskedasticity (constant variance)}\)</span>.</p>
<p>Test statistic: <span class="math inline">\(\chi^2 = N \cdot R^2_{\text{aux}}\)</span> <br></p>
<p>where <span class="math inline">\(R^2_{\text{aux}}\)</span> comes from regressing <strong>squared residuals</strong> on the original regressors:</p>
<p><span class="math inline">\(\hat{e}_i^{\,2}
= \gamma_0 + \gamma_1 x_{i1} + \gamma_2 x_{i2} + \cdots + \gamma_k x_{ik} + \text{error}\)</span> <br></p>
<p>Under <span class="math inline">\(H_0\)</span>, <span class="math inline">\(\chi^2 \sim \chi^2_k\)</span> (k = number of regressors, excluding intercept).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span>                              <span class="co"># significance level (5%)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ressq <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod1)<span class="sc">^</span><span class="dv">2</span>                     <span class="co"># squared residuals (used to detect heteroskedasticity)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>modres <span class="ot">&lt;-</span> <span class="fu">lm</span>(ressq <span class="sc">~</span> income, <span class="at">data =</span> food)  <span class="co"># auxiliary regression: regress squared residuals on income</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">nobs</span>(modres)                           <span class="co"># number of observations</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="fu">summary</span>(modres)<span class="sc">$</span>df[<span class="dv">2</span>]                  <span class="co"># degrees of freedom for regression (k = number of predictors)</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>chisqcr <span class="ot">&lt;-</span> <span class="fu">qchisq</span>(<span class="dv">1</span> <span class="sc">-</span> alpha, S)             <span class="co"># chi-square critical value (right tail)</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>Rsqres <span class="ot">&lt;-</span> <span class="fu">summary</span>(modres)<span class="sc">$</span>r.squared         <span class="co"># R² from auxiliary regression</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>chisq  <span class="ot">&lt;-</span> N <span class="sc">*</span> Rsqres                        <span class="co"># Breusch–Pagan test statistic</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>pval   <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(chisq, S)              <span class="co"># p-value (probability of observing that statistic or larger)</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">statistic =</span> chisq, <span class="at">crit =</span> chisqcr, <span class="at">p.value =</span> pval)   <span class="co"># show results: test statistic, critical value, p-value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>statistic      crit   p.value 
 7.384424 53.383541  1.000000 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpreting the Breusch–Pagan test
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Decision rule:</strong> - If <strong>p-value &lt; 0.05</strong> (or your chosen <span class="math inline">\(\alpha\)</span>): reject <span class="math inline">\(H_0\)</span> → evidence against homoskedasticity (i.e., evidence of heteroskedasticity) - If <strong>p-value ≥ 0.05</strong>: fail to reject <span class="math inline">\(H_0\)</span> → no strong evidence of heteroskedasticity</p>
<p>Alternatively, compare the test statistic to the critical value: - If <strong><span class="math inline">\(\chi^2\)</span> &gt; critical value</strong>: reject <span class="math inline">\(H_0\)</span> - If <strong><span class="math inline">\(\chi^2\)</span> ≤ critical value</strong>: fail to reject <span class="math inline">\(H_0\)</span></p>
<p>In this example, if p-value is small (&lt; 0.05), we have evidence that variance increases with income.</p>
</div>
</div>
</section>
<section id="white-quadratic-version" class="level3">
<h3 class="anchored" data-anchor-id="white-quadratic-version">White (quadratic) version</h3>
<p>White’s test extends Breusch–Pagan by including squares and cross-products of regressors in the auxiliary regression. This detects more general forms of heteroskedasticity (not just linear). For a model with one regressor <span class="math inline">\(x\)</span>:</p>
<p><span class="math inline">\(\hat{e}_i^{\,2} = \gamma_0 + \gamma_1 x_{i1} + \gamma_2 x^2_{i2} + \text{error}\)</span></p>
<p>Test statistic: <span class="math inline">\(\chi^2 = N \cdot R^2_{\text{aux}}\)</span> ∼ <span class="math inline">\(\chi^2_k\)</span>, where <span class="math inline">\(k\)</span> is the number of regressors in the auxiliary regression (excluding the intercept).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># auxiliary regression with quadratic term (tests nonlinear heteroskedasticity)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>modres2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(ressq <span class="sc">~</span> income <span class="sc">+</span> <span class="fu">I</span>(income<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> food)    </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>Rsq2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(modres2)<span class="sc">$</span>r.squared          <span class="co"># R² from auxiliary regression</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>S2   <span class="ot">&lt;-</span> <span class="fu">summary</span>(modres2)<span class="sc">$</span>df[<span class="dv">2</span>]              <span class="co"># degrees of freedom (number of regressors)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>chisq2 <span class="ot">&lt;-</span> N <span class="sc">*</span> Rsq2                          <span class="co"># Breusch–Pagan-type chi-square statistic</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>pval2  <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(chisq2, S2)            <span class="co"># p-value (right-tail)</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">statistic =</span> chisq2, <span class="at">df =</span> S2, <span class="at">p.value =</span> pval2)            <span class="co"># show results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>statistic        df   p.value 
 7.555079 37.000000  1.000000 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpreting White’s test
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Decision rule:</strong> - If <strong>p-value &lt; 0.05</strong>: reject <span class="math inline">\(H_0\)</span> → evidence of heteroskedasticity (possibly nonlinear) - If <strong>p-value ≥ 0.05</strong>: fail to reject <span class="math inline">\(H_0\)</span> → no strong evidence</p>
<p>White’s test is more general than Breusch–Pagan (detects nonlinear heteroskedasticity) but uses more degrees of freedom. In small samples, use Breusch–Pagan if you suspect linear heteroskedasticity, or White if you suspect more complex patterns.</p>
</div>
</div>
</section>
<section id="breuschpagan-with-bptest" class="level3">
<h3 class="anchored" data-anchor-id="breuschpagan-with-bptest">Breusch–Pagan with <code>bptest()</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run Breusch–Pagan test and tidy the output</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># display results as a formatted table</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">tidy</span>(<span class="fu">bptest</span>(mod1)), <span class="at">caption =</span> <span class="st">"Breusch–Pagan heteroskedasticity test"</span>)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Breusch–Pagan heteroskedasticity test</caption>
<thead>
<tr class="header">
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">parameter</th>
<th style="text-align: left;">method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">7.384424</td>
<td style="text-align: right;">0.0065791</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">studentized Breusch-Pagan test</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpreting <code>bptest()</code> output
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>bptest()</code> function reports: - <strong>statistic</strong>: the BP test statistic (approximately <span class="math inline">\(\chi^2\)</span> distributed) - <strong>p.value</strong>: probability of observing this statistic under <span class="math inline">\(H_0\)</span> - <strong>parameter</strong>: degrees of freedom</p>
<p><strong>Decision:</strong> If p-value &lt; 0.05, reject homoskedasticity and consider using robust standard errors.</p>
</div>
</div>
</section>
<section id="goldfeldquandt-test-indicator-split-metro-vs-rural" class="level3">
<h3 class="anchored" data-anchor-id="goldfeldquandt-test-indicator-split-metro-vs-rural">Goldfeld–Quandt test (indicator split: metro vs rural)</h3>
<p>Tests whether error variance differs between two subgroups. Split the sample by a grouping variable or by ordering observations (e.g., by income level).</p>
<p><strong>Test statistic:</strong><br>
<span class="math inline">\(F = \dfrac{\hat{\sigma}_1^{\,2}}{\hat{\sigma}_2^{\,2}}\)</span> <br></p>
<p>where <span class="math inline">\(\hat{\sigma}_1^{\,2}\)</span> and <span class="math inline">\(\hat{\sigma}_2^{\,2}\)</span> are estimated error variances from each subsample.</p>
<p>Under <span class="math inline">\(H_0\)</span> (equal variances),<br>
<span class="math inline">\(F \sim F_{df_1, df_2}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span>                           <span class="co"># significance level (5%)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"cps2"</span>, <span class="at">package =</span> <span class="st">"PoEdata"</span>)       <span class="co"># load CPS dataset</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> cps2[cps2<span class="sc">$</span>metro <span class="sc">==</span> <span class="dv">1</span>, ]            <span class="co"># subset: people living in metropolitan areas</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> cps2[cps2<span class="sc">$</span>metro <span class="sc">==</span> <span class="dv">0</span>, ]            <span class="co"># subset: people NOT living in metropolitan areas</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>wg1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper, <span class="at">data =</span> m)           <span class="co"># regression for metro group</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>wg0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ <span class="sc">+</span> exper, <span class="at">data =</span> r)           <span class="co"># regression for non-metro group</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> wg1<span class="sc">$</span>df.residual                   <span class="co"># residual degrees of freedom (metro model)</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>df0 <span class="ot">&lt;-</span> wg0<span class="sc">$</span>df.residual                   <span class="co"># residual degrees of freedom (non-metro model)</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>sig1 <span class="ot">&lt;-</span> <span class="fu">summary</span>(wg1)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span>             <span class="co"># estimated error variance metro</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>sig0 <span class="ot">&lt;-</span> <span class="fu">summary</span>(wg0)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span>             <span class="co"># estimated error variance non-metro</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>fstat <span class="ot">&lt;-</span> sig1 <span class="sc">/</span> sig0                     <span class="co"># F-statistic: ratio of variances</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>Flc <span class="ot">&lt;-</span> <span class="fu">qf</span>(alpha<span class="sc">/</span><span class="dv">2</span>, df1, df0)             <span class="co"># lower critical value from F distribution</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>Fuc <span class="ot">&lt;-</span> <span class="fu">qf</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>, df1, df0)         <span class="co"># upper critical value (two-tail test)</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">F =</span> fstat, <span class="at">Flc =</span> Flc, <span class="at">Fuc =</span> Fuc)       <span class="co"># display F statistic and critical bounds</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        F       Flc       Fuc 
2.0877623 0.8051984 1.2617297 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpreting the Goldfeld–Quandt test
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Decision rule (two-tailed test):</strong> - If <span class="math inline">\(F &lt;\)</span> lower critical value OR <span class="math inline">\(F &gt;\)</span> upper critical value: reject <span class="math inline">\(H_0\)</span> → variances differ - If <span class="math inline">\(F\)</span> lies between the two critical values: fail to reject <span class="math inline">\(H_0\)</span></p>
<p><strong>Decision rule (one-tailed test):</strong> - If <span class="math inline">\(F &gt;\)</span> upper critical value (or p-value &lt; 0.05): reject <span class="math inline">\(H_0\)</span> → variance in group 1 is larger</p>
<p>In this metro vs.&nbsp;rural example, a significant F-statistic suggests systematic differences in wage variance between regions.</p>
</div>
</div>
<p>Goldfeld–Quandt without an indicator (split by median income):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span>                                   <span class="co"># significance level (5%)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>medianincome <span class="ot">&lt;-</span> <span class="fu">median</span>(food<span class="sc">$</span>income)             <span class="co"># compute median income</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Split sample into low-income and high-income groups</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>li <span class="ot">&lt;-</span> food[food<span class="sc">$</span>income <span class="sc">&lt;=</span> medianincome, ]       <span class="co"># low-income group (&lt;= median)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>hi <span class="ot">&lt;-</span> food[food<span class="sc">$</span>income <span class="sc">&gt;=</span> medianincome, ]       <span class="co"># high-income group (&gt;= median)</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the same regression separately in each subgroup</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>eqli <span class="ot">&lt;-</span> <span class="fu">lm</span>(food_exp <span class="sc">~</span> income, <span class="at">data =</span> li)        <span class="co"># model for low-income group</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>eqhi <span class="ot">&lt;-</span> <span class="fu">lm</span>(food_exp <span class="sc">~</span> income, <span class="at">data =</span> hi)        <span class="co"># model for high-income group</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract degrees of freedom and residual variances</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>dfli <span class="ot">&lt;-</span> eqli<span class="sc">$</span>df.residual; dfhi <span class="ot">&lt;-</span> eqhi<span class="sc">$</span>df.residual   <span class="co"># residual degrees of freedom</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>sqli <span class="ot">&lt;-</span> <span class="fu">summary</span>(eqli)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span>; sqhi <span class="ot">&lt;-</span> <span class="fu">summary</span>(eqhi)<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span>  <span class="co"># estimated error variances</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co"># F test comparing variances (heteroskedasticity between groups)</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>fstat <span class="ot">&lt;-</span> sqhi <span class="sc">/</span> sqli                            <span class="co"># F statistic: ratio of variances</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>Fc    <span class="ot">&lt;-</span> <span class="fu">qf</span>(<span class="dv">1</span> <span class="sc">-</span> alpha, dfhi, dfli)              <span class="co"># critical value (right-tail test)</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>pval  <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(fstat, dfhi, dfli)              <span class="co"># p-value</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">F =</span> fstat, <span class="at">Fcrit =</span> Fc, <span class="at">p.value =</span> pval)        <span class="co"># display test statistic, critical value, and p-value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         F      Fcrit    p.value 
3.61475572 2.21719713 0.00459643 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpreting the GQ test (one-tailed)
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Decision rule:</strong> - If <strong>p-value &lt; 0.05</strong>: reject <span class="math inline">\(H_0\)</span> → variance increases with income - If <strong>F &gt; critical value</strong>: reject <span class="math inline">\(H_0\)</span></p>
<p>This version tests whether high-income households have <strong>more variable</strong> food expenditure than low-income households.</p>
</div>
</div>
<p>Or use <code>gqtest()</code> directly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>foodeq <span class="ot">&lt;-</span> <span class="fu">lm</span>(food_exp <span class="sc">~</span> income, <span class="at">data =</span> food)          <span class="co"># baseline OLS</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Goldfeld–Quandt test for heteroskedasticity:</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - order.by = food$income: sort observations by income</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - point = 0.5: split the sample around the middle (drops central portion)</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - alternative = "greater": tests whether variance is larger in the upper group</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>tst <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">gqtest</span>(foodeq,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">point =</span> <span class="fl">0.5</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">alternative =</span> <span class="st">"greater"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">order.by =</span> food<span class="sc">$</span>income)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy + nicely format test output</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">tidy</span>(tst),                              </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"R function `gqtest()` with the 'food' equation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Multiple parameters; naming those columns df1 and df2.</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>R function <code>gqtest()</code> with the ‘food’ equation</caption>
<colgroup>
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 23%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">df1</th>
<th style="text-align: right;">df2</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: left;">method</th>
<th style="text-align: left;">alternative</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">18</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">3.614756</td>
<td style="text-align: right;">0.0045964</td>
<td style="text-align: left;">Goldfeld-Quandt test</td>
<td style="text-align: left;">variance increases from segment 1 to 2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Interpreting <code>gqtest()</code> output
</div>
</div>
<div class="callout-body-container callout-body">
<p>The function reports: - <strong>statistic</strong>: F-ratio comparing variances - <strong>p.value</strong>: one-tailed (tests “greater” alternative by default) - <strong>parameter</strong>: degrees of freedom for numerator and denominator</p>
<p><strong>Decision:</strong> If p-value &lt; 0.05, conclude that variance is significantly larger in the upper group (heteroskedasticity present).</p>
<p><strong>Note:</strong> <code>point = 0.5</code> means observations are split around the median. Adjust this parameter if you want to drop more/fewer central observations.</p>
</div>
</div>
</section>
<section id="heteroskedasticityconsistent-hc-standard-errors" class="level3">
<h3 class="anchored" data-anchor-id="heteroskedasticityconsistent-hc-standard-errors">Heteroskedasticity‑consistent (HC) standard errors</h3>
<p>Heteroskedasticity-consistent (robust) standard errors When heteroskedasticity is detected, one solution is to use robust standard errors (also called White standard errors or HC standard errors). These adjust the variance-covariance matrix to account for non-constant variance without changing the coefficient estimates.</p>
<p>Key types:</p>
<p>HC0: White’s original estimator HC1: degrees-of-freedom adjustment (recommended for small samples) HC2, HC3: further refinements for leverage and influence</p>
<p>The OLS point estimates remain unchanged—only the standard errors (and thus t-statistics and p-values) are corrected.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>foodeq <span class="ot">&lt;-</span> <span class="fu">lm</span>(food_exp <span class="sc">~</span> income, <span class="at">data =</span> food)          <span class="co"># baseline regression</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">tidy</span>(foodeq),                                   <span class="co"># show coefficients with regular SEs</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Regular standard errors in the 'food' equation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Regular standard errors in the ‘food’ equation</caption>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">83.41600</td>
<td style="text-align: right;">43.410163</td>
<td style="text-align: right;">1.921578</td>
<td style="text-align: right;">0.0621824</td>
</tr>
<tr class="even">
<td style="text-align: left;">income</td>
<td style="text-align: right;">10.20964</td>
<td style="text-align: right;">2.093263</td>
<td style="text-align: right;">4.877381</td>
<td style="text-align: right;">0.0000195</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>cov1 <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">hccm</span>(foodeq, <span class="at">type =</span> <span class="st">"hc1"</span>)               <span class="co"># compute robust (HC1) covariance matrix</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>food.HC1 <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">coeftest</span>(foodeq, <span class="at">vcov. =</span> cov1)    <span class="co"># apply robust SEs to regression output</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">tidy</span>(food.HC1),                                 <span class="co"># show coefficients with robust SEs</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Robust (HC1) standard errors in the 'food' equation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Robust (HC1) standard errors in the ‘food’ equation</caption>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">83.41600</td>
<td style="text-align: right;">27.463748</td>
<td style="text-align: right;">3.037313</td>
<td style="text-align: right;">0.0042989</td>
</tr>
<tr class="even">
<td style="text-align: left;">income</td>
<td style="text-align: right;">10.20964</td>
<td style="text-align: right;">1.809077</td>
<td style="text-align: right;">5.643566</td>
<td style="text-align: right;">0.0000018</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Robust (HC) errors <strong>fix inference</strong> under heteroskedasticity, but the <strong>point estimates are unchanged</strong>.</p>
</div>
</div>
<hr>
</section>
<section id="summary-1" class="level3">
<h3 class="anchored" data-anchor-id="summary-1">Summary</h3>
<ul>
<li>You applied the technique in R, produced tidy outputs, and interpreted them in context.</li>
<li>Keep focusing on clean tables, explicit assumptions, and diagnostics that justify your specification.</li>
<li>Use the provided patterns as a template for future empirical work.</li>
</ul>
<hr>
</section>
</section>
<section id="lab-16-serial-correlation-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="lab-16-serial-correlation-autocorrelation">Lab 16 — Serial Correlation (Autocorrelation)</h2>
<section id="learning-outcomes-2" class="level3">
<h3 class="anchored" data-anchor-id="learning-outcomes-2">🎯 Learning outcomes</h3>
<ul>
<li>Understand the core ideas and assumptions for this lab’s topic.</li>
<li>Implement the workflow in R and create tidy outputs with clear captions.</li>
<li>Interpret results in context and connect diagnostics to modeling decisions.</li>
<li>Recognise common pitfalls and perform basic robustness checks.</li>
</ul>
<hr>
</section>
<section id="prerequisites-2" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites-2">🧰 Prerequisites</h3>
<ul>
<li>Multiple regression and inference (t-tests, F-tests).</li>
<li>R and RStudio installed.</li>
<li>Packages: <code>broom</code>, <code>knitr</code>, and any other packages used in the lab code.</li>
</ul>
<hr>
</section>
<section id="overview-1" class="level3">
<h3 class="anchored" data-anchor-id="overview-1">Overview</h3>
<p>This lab situates the technique within the broader econometric workflow, explaining why it matters for inference and decision‑making. You will implement it in R, assess assumptions/diagnostics, and justify specification choices.</p>
<hr>
<p>Serial correlation is correlation across time in a series. In regression, <strong>autocorrelated errors</strong> lead to <strong>incorrect standard errors</strong> (and misleading (t)-tests).</p>
</section>
<section id="example-growth-vs-unemployment-okuns-data" class="level3">
<h3 class="anchored" data-anchor-id="example-growth-vs-unemployment-okuns-data">Example: growth vs unemployment (Okun’s data)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"okun"</span>, <span class="at">package =</span> <span class="st">"PoEdata"</span>)             <span class="co"># load Okun's law quarterly dataset</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>okun.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(okun, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1948</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">4</span>)  <span class="co"># convert to quarterly time-series object</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot time series</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(okun.ts[, <span class="st">"g"</span>], <span class="at">ylab =</span> <span class="st">"growth"</span>)         <span class="co"># real GDP growth over time</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="supervision_4_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(okun.ts[, <span class="st">"u"</span>], <span class="at">ylab =</span> <span class="st">"unemployment"</span>)   <span class="co"># unemployment rate over time</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="supervision_4_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter with lags/leads</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>ggL1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">g   =</span> okun.ts[, <span class="st">"g"</span>],</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">gL1 =</span> stats<span class="sc">::</span><span class="fu">lag</span>(okun.ts[, <span class="st">"g"</span>], <span class="sc">-</span><span class="dv">1</span>)        <span class="co"># lead by 1 quarter (stats::lag with -1 shifts forward)</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ggL1)                                    <span class="co"># scatter of g vs. g(+1)</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(ggL1<span class="sc">$</span>gL1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),      <span class="co"># horizontal line at mean of g(+1)</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">v =</span> <span class="fu">mean</span>(ggL1<span class="sc">$</span>g,   <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">lty =</span> <span class="dv">2</span>)       <span class="co"># vertical line at mean of g</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="supervision_4_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ggL2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">g   =</span> okun.ts[, <span class="st">"g"</span>],</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gL2 =</span> stats<span class="sc">::</span><span class="fu">lag</span>(okun.ts[, <span class="st">"g"</span>], <span class="sc">-</span><span class="dv">2</span>)        <span class="co"># lead by 2 quarters</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ggL2)                                    <span class="co"># scatter of g vs. g(+2)</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(ggL2<span class="sc">$</span>gL2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">v =</span> <span class="fu">mean</span>(ggL2<span class="sc">$</span>g,   <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="supervision_4_files/figure-html/unnamed-chunk-13-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlogram (autocorrelation function) for growth</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(okun.ts[, <span class="st">"g"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="supervision_4_files/figure-html/unnamed-chunk-13-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="phillips-curve-example-and-bgdw-tests" class="level3">
<h3 class="anchored" data-anchor-id="phillips-curve-example-and-bgdw-tests">Phillips curve example and BG/DW tests</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dynlm)                                 <span class="co"># dynamic linear models for time series</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dynlm' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"phillips_aus"</span>, <span class="at">package =</span> <span class="st">"PoEdata"</span>)      <span class="co"># Australian Phillips-curve data</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>phill.ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(phillips_aus, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1987</span>, <span class="dv">1</span>), <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">2009</span>, <span class="dv">3</span>), <span class="at">frequency =</span> <span class="dv">4</span>)  <span class="co"># quarterly ts</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>inflation <span class="ot">&lt;-</span> phill.ts[, <span class="st">"inf"</span>]                 <span class="co"># inflation series</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>Du <span class="ot">&lt;-</span> <span class="fu">diff</span>(phill.ts[, <span class="st">"u"</span>])                    <span class="co"># change in unemployment (∆u_t)</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># FDL model: inf_t = β1 + β2 * ∆u_t + e_t</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>phill.dyn <span class="ot">&lt;-</span> <span class="fu">dynlm</span>(inf <span class="sc">~</span> <span class="fu">diff</span>(u), <span class="at">data =</span> phill.ts)                 <span class="co"># regress inflation on ∆unemployment</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">tidy</span>(phill.dyn), <span class="at">caption =</span> <span class="st">"Summary of the `phillips` model"</span>)<span class="co"># tidy+format regression output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `tidy()` method for objects of class `dynlm` is not maintained by the broom team, and is only supported through the `lm` tidier method. Please be cautious in interpreting and reporting broom output.

This warning is displayed once per session.</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Summary of the <code>phillips</code> model</caption>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.7776213</td>
<td style="text-align: right;">0.0658249</td>
<td style="text-align: right;">11.813474</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">diff(u)</td>
<td style="text-align: right;">-0.5278638</td>
<td style="text-align: right;">0.2294049</td>
<td style="text-align: right;">-2.301014</td>
<td style="text-align: right;">0.0237539</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual plot and correlogram (check for serial correlation)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>ehat <span class="ot">&lt;-</span> <span class="fu">resid</span>(phill.dyn)                       <span class="co"># regression residuals</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ehat); <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>)             <span class="co"># residuals over time, zero reference</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="supervision_4_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(ehat)                                      <span class="co"># ACF of residuals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="supervision_4_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Breusch–Godfrey tests (different orders/statistics):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: preserving your object names a, b, c, d and test types.</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (We only use base::c() below to avoid masking by object 'c')</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># type = "F" can be preferable in small samples (finite-sample adjustment)</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">bgtest</span>(phill.dyn, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">"F"</span>,     <span class="at">fill =</span> <span class="dv">0</span>)   <span class="co"># BG test AR(1); replace initial NAs by 0</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">bgtest</span>(phill.dyn, <span class="at">order =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">"F"</span>,     <span class="at">fill =</span> <span class="cn">NA</span>)  <span class="co"># BG test AR(1); drop obs with initial NAs</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">bgtest</span>(phill.dyn, <span class="at">order =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"Chisq"</span>, <span class="at">fill =</span> <span class="dv">0</span>)   <span class="co"># BG test AR(4); large-sample chi-square; fill 0</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> lmtest<span class="sc">::</span><span class="fu">bgtest</span>(phill.dyn, <span class="at">order =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"Chisq"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)  <span class="co"># BG test AR(4); drop initial NAs</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect results into a neat table</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>dfr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Method     =</span> base<span class="sc">::</span><span class="fu">c</span>(<span class="st">"1, F, 0"</span>, <span class="st">"1, F, NA"</span>, <span class="st">"4, Chisq, 0"</span>, <span class="st">"4, Chisq, NA"</span>),</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Statistic  =</span> base<span class="sc">::</span><span class="fu">c</span>(<span class="fu">unname</span>(a<span class="sc">$</span>statistic), <span class="fu">unname</span>(b<span class="sc">$</span>statistic),</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">unname</span>(c<span class="sc">$</span>statistic), <span class="fu">unname</span>(d<span class="sc">$</span>statistic)),      <span class="co"># test statistic values</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Parameters =</span> base<span class="sc">::</span><span class="fu">c</span>(<span class="fu">sprintf</span>(<span class="st">"df1=%g, df2=%g"</span>, a<span class="sc">$</span>parameter[<span class="dv">1</span>], a<span class="sc">$</span>parameter[<span class="dv">2</span>]),</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">sprintf</span>(<span class="st">"df1=%g, df2=%g"</span>, b<span class="sc">$</span>parameter[<span class="dv">1</span>], b<span class="sc">$</span>parameter[<span class="dv">2</span>]),</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">sprintf</span>(<span class="st">"df=%g"</span>,          c<span class="sc">$</span>parameter),          <span class="co"># chi-square df</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">sprintf</span>(<span class="st">"df=%g"</span>,          d<span class="sc">$</span>parameter)),</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_value    =</span> base<span class="sc">::</span><span class="fu">c</span>(a<span class="sc">$</span>p.value, b<span class="sc">$</span>p.value, c<span class="sc">$</span>p.value, d<span class="sc">$</span>p.value)     <span class="co"># p-values</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(dfr, <span class="at">caption =</span> <span class="st">"Breusch–Godfrey test for the Phillips example."</span>)  <span class="co"># nicely formatted summary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Breusch–Godfrey test for the Phillips example.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: right;">Statistic</th>
<th style="text-align: left;">Parameters</th>
<th style="text-align: right;">p_value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1, F, 0</td>
<td style="text-align: right;">38.46538</td>
<td style="text-align: left;">df1=1, df2=87</td>
<td style="text-align: right;">0e+00</td>
</tr>
<tr class="even">
<td style="text-align: left;">1, F, NA</td>
<td style="text-align: right;">38.69456</td>
<td style="text-align: left;">df1=1, df2=86</td>
<td style="text-align: right;">0e+00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4, Chisq, 0</td>
<td style="text-align: right;">36.67190</td>
<td style="text-align: left;">df=4</td>
<td style="text-align: right;">2e-07</td>
</tr>
<tr class="even">
<td style="text-align: left;">4, Chisq, NA</td>
<td style="text-align: right;">33.59372</td>
<td style="text-align: left;">df=4</td>
<td style="text-align: right;">9e-07</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Durbin–Watson (DW targets AR(1) and isn’t valid with a lagged dependent variable(prefer Breusch–Godfrey for more general cases):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">dwtest</span>(phill.dyn)   <span class="co"># Durbin–Watson test for AR(1) autocorrelation in residuals (H0: no autocorrelation)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Durbin-Watson test

data:  phill.dyn
DW = 0.88729, p-value = 2.198e-09
alternative hypothesis: true autocorrelation is greater than 0</code></pre>
</div>
</div>
<hr>
</section>
<section id="summary-2" class="level3">
<h3 class="anchored" data-anchor-id="summary-2">Summary</h3>
<ul>
<li>You implemented the method in R and produced clean, well‑captioned outputs.</li>
<li>Diagnostics and assumptions inform how you specify and interpret the model.</li>
<li>Use these patterns as a template for future empirical work.</li>
</ul>
<hr>
</section>
</section>
<section id="lab-17-hac-neweywest-standard-errors" class="level2">
<h2 class="anchored" data-anchor-id="lab-17-hac-neweywest-standard-errors">Lab 17 — HAC (Newey–West) Standard Errors</h2>
<section id="learning-outcomes-3" class="level3">
<h3 class="anchored" data-anchor-id="learning-outcomes-3">🎯 Learning outcomes</h3>
<ul>
<li>Grasp the core concept(s) of this lab and where they fit in the modelling workflow.</li>
<li>Implement the R workflow cleanly, producing tidy outputs with clear captions.</li>
<li>Interpret results carefully and connect diagnostics/assumptions to modelling choices.</li>
<li>Identify pitfalls and perform simple robustness checks.</li>
</ul>
<hr>
</section>
<section id="prerequisites-3" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites-3">🧰 Prerequisites</h3>
<ul>
<li>Multiple regression, inference (t-tests, F-tests), and model diagnostics basics.</li>
<li>R and RStudio installed.</li>
<li>Packages: <code>broom</code>, <code>knitr</code>, plus any additional packages used in this lab.</li>
</ul>
<hr>
</section>
<section id="overview-2" class="level3">
<h3 class="anchored" data-anchor-id="overview-2">Overview</h3>
<p>This lab introduces the concept, explains why it matters for inference and decision‑making, and demonstrates implementation in R. You will interpret results in context and motivate specification choices using diagnostics.</p>
<hr>
<p>Correct standard errors under autocorrelation (and heteroskedasticity) using <strong>HAC</strong> estimators.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich); <span class="fu">library</span>(lmtest)                        <span class="co"># robust VCOVs + testing tools</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>s0 <span class="ot">&lt;-</span> <span class="fu">coeftest</span>(phill.dyn)                                 <span class="co"># OLS SEs (incorrect if residuals have autocorrelation)</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">coeftest</span>(phill.dyn, <span class="at">vcov. =</span> <span class="fu">vcovHAC</span>(phill.dyn))     <span class="co"># HAC (heteroskedasticity &amp; autocorrelation consistent)</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="fu">coeftest</span>(phill.dyn, <span class="at">vcov. =</span> <span class="fu">NeweyWest</span>(phill.dyn))   <span class="co"># Newey–West (a common HAC estimator)</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>s3 <span class="ot">&lt;-</span> <span class="fu">coeftest</span>(phill.dyn, <span class="at">vcov. =</span> <span class="fu">kernHAC</span>(phill.dyn))     <span class="co"># kernel-based HAC (Andrews-type)</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect just the (Std. Error, Pr(&gt;|t|)) rows/cols and compare across methods</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(s0[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)], s1[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)], s2[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)], s3[<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)]))</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(tbl) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Incorrect"</span>, <span class="st">"vcovHAC"</span>, <span class="st">"NeweyWest"</span>, <span class="st">"kernHAC"</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(tbl) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"Du"</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(tbl, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">caption =</span> <span class="st">"Comparing standard errors for the Phillips model."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Comparing standard errors for the Phillips model.</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Incorrect</th>
<th style="text-align: right;">vcovHAC</th>
<th style="text-align: right;">NeweyWest</th>
<th style="text-align: right;">kernHAC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.066</td>
<td style="text-align: right;">0.095</td>
<td style="text-align: right;">0.128</td>
<td style="text-align: right;">0.131</td>
</tr>
<tr class="even">
<td style="text-align: left;">Du</td>
<td style="text-align: right;">0.229</td>
<td style="text-align: right;">0.304</td>
<td style="text-align: right;">0.331</td>
<td style="text-align: right;">0.335</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>HAC fixes <strong>inference</strong> but not <strong>efficiency</strong>: OLS with HAC is still not minimum‑variance when errors are autocorrelated.</p>
</div>
</div>
<hr>
</section>
<section id="summary-3" class="level3">
<h3 class="anchored" data-anchor-id="summary-3">Summary</h3>
<ul>
<li>You implemented the method in R, produced clean outputs, and interpreted them in context.</li>
<li>Diagnostics/assumptions inform specification choices and robustness checks.</li>
<li>Reuse this structure as a template for future empirical work.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./supervision_3.html" class="pagination-link" aria-label="Supervision 3">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Supervision 3</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./supervision_5.html" class="pagination-link" aria-label="Supervision 5">
        <span class="nav-page-text"><span class="chapter-title">Supervision 5</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>